### destination

更方便、快速的修改 apollo 配置

### 设计方案

#### 1. 获取登录态

获取当前登录的 google 账号，用该 google 账号登录 apollo，获取有权限的 app 列表
当前只适用于 chatbot 下配置信息的修改，因此默认 app 为 chatbot-api,如果没有 chatbot-api 的项目权限，则展示空白页面；

#### 2. 获取环境和集群、以及集群下的命名空间等信息

项目中默认的环境为`Test`,`UAT`,`Staging`,默认的集群为七个地区，命名空间信息需要在选择相应的环境和集群后拉取；

#### 3. 修改信息

在选中相应的命名空间后，拉取配置信息。解析配置信息，如果解析失败，就提示请在 apollo 中修改，本插件不支持非 JSON 结构的信息；
解析成功之后页面展示为一个树结构，对应 JSON 结构 key-value 键值对中，所有 value 类型为 Object 的都带有 edit 按钮；点击 edit，页面就会展示对应解析后的结构，可修改;
本插件暂不支持删除功能，也不支持校验功能；

选中编辑的内容后，该选中内容的 key 不可修改，只能修改子元素；也就是说，JSON 结构下的一层子元素的 key 是不可修改的，因为需要这个 key 来寻找同步到其他地区的深度和位置；

#### 4. 提交、发布

修改结束后，点击提交，提交至 apollo；点击发布，功能与 apollo 发布相同；

#### 5. 一键同步功能

该功能是本插件特有的功能，也是本插件开发的目的；旨在减少因不同集群需要不同配置，而这些配置又存在高度相似性(例如配置中含与环境、集群有关的变量信息，举例：TMC query 配置)；

具体流程如下：
在 test 环境、th 地区修改了配置 -> 在**提交**之后，可同步其他环境和地区 -> 点击一键同步按钮 ——> 弹出弹框，选择需要同步的环境和地区，环境只能单选，集群可多选，当前集群不可选 -> 选择完后点击确定 -> 同步更新

注意：这里的一键同步暂不支持发布功能，只能提交修改，真实的发布还需要去 apollo 手动点击发布

如何同步更新：

1. 判断当前内容是否已提交
2. 记录当前修改内容的 key;key 为 array 类型
3. 获取当前选中的需要同步的集群，拉取他们的配置，判断配置中在对应位置是否存在对应的 key；
4. 如果不存，修改失败，失败原因：JSON 结构有差异；
5. 如果存在，直接替换；
6. 然后依次提交；

#### 6. 字符串转换功能

该功能是本插件特有的功能，目的在于支持同步功能的不同需求；（参考 TMC query 配置）
可以在修改内容时使用该功能；

在修改内容时，针对类型为 string/number 的 value 的修改（目前只针对 value 实现了该功能），在输入时，可选择是否需要 encode，以及是否需要变量替换的功能；

- encode: 使用 encodeURIComponent 对输入的字符串进行编码 （是否可以自动解析？）
- 字符串模版: 针对一些字符串模版，其中的变量需要按照环境和集群的不同而替换成不同的值；
  - 目前支持的变量替换，`${cluster}`和`${env}`，这样的写法会替换成对应的环境和集群（后期可维护一份变量替换列表，支持更多的替换规则？？？）
  - 字符串反解析， 将替换过的字符串恢复成原始的字符串模版，这样是方便查看原始字符串，也方便在一键同步时替换；
    - 需要注意的是，如果在修改时不开启变量替换的功能，那么在一键同步时也不会开启该功能，如果在修改时对应的字符串开启了变量替换的功能，那么在一键同步时对应的字符串也会开启该功能；

#### 7. 其他
